@* ============================================================
   MODULE 8 - ORDER CONFIRMATION (CHECK OUT COUNTER)
   Controller : ShopController.cs  →  Action: OrderConfirmation
   Model      : OrderConfirmationViewModel
   Note       : After displaying, redirects user back to Products
   ============================================================ *@

@model RunGear.Models.OrderConfirmationViewModel

@{
    ViewBag.Title      = "Order Confirmed";
    ViewBag.ActivePage = "";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
<style>
    .confirm-wrapper {
        max-width: 540px; margin: 60px auto; padding: 0 24px;
        display: flex; flex-direction: column; align-items: center; text-align: center;
    }

    /* ── Check Icon ── */
    .confirm-icon {
        width: 70px; height: 70px; background: #0a0a0a; border-radius: 50%;
        display: flex; align-items: center; justify-content: center; margin-bottom: 22px;
    }
    .confirm-icon svg {
        width: 32px; height: 32px; stroke: #fff; fill: none;
        stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round;
    }

    .confirm-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 42px; letter-spacing: 2px; margin-bottom: 8px;
    }
    .confirm-sub { font-size: 14px; color: #888; margin-bottom: 20px; }

    .order-id-box {
        border: 1px solid #e8e8e8; border-radius: 6px;
        padding: 10px 28px; font-size: 13px; font-weight: 600; color: #3a3a3a;
        margin-bottom: 28px;
    }

    /* ── Card ── */
    .confirm-card {
        width: 100%; border: 1px solid #e8e8e8; border-radius: 10px;
        overflow: hidden; text-align: left; margin-bottom: 24px;
    }
    .confirm-section { padding: 20px 24px; }
    .confirm-section + .confirm-section { border-top: 1px solid #e8e8e8; }
    .confirm-section-title { font-size: 13px; font-weight: 700; margin-bottom: 10px; }
    .confirm-address { font-size: 13px; color: #3a3a3a; line-height: 1.8; }

    /* ── Order Items Summary ── */
    .confirm-items { display: flex; flex-direction: column; gap: 10px; }
    .confirm-item { display: flex; align-items: center; gap: 10px; }
    .confirm-item-img {
        width: 44px; height: 44px; border-radius: 5px;
        object-fit: cover; background: #f5f5f5; flex-shrink: 0;
    }
    .confirm-item-name { font-size: 13px; font-weight: 600; }
    .confirm-item-meta { font-size: 11px; color: #888; }
    .confirm-item-price { margin-left: auto; font-size: 13px; font-weight: 700; }

    /* ── Order Total ── */
    .confirm-totals { margin-top: 12px; }
    .confirm-total-row { display: flex; justify-content: space-between; font-size: 12px; color: #888; margin-bottom: 4px; }
    .confirm-total-row.grand { font-size: 15px; font-weight: 700; color: #0a0a0a; margin-top: 8px; }

    /* ── Tracking Stepper ── */
    .track-steps { display: flex; align-items: flex-start; margin-bottom: 10px; }
    .track-step {
        display: flex; flex-direction: column; align-items: center; gap: 4px;
        flex: 1; position: relative;
    }
    .track-step:not(:last-child)::after {
        content: ''; position: absolute; top: 14px; left: 50%;
        width: 100%; height: 2px; background: #d4d4d4; z-index: 0;
    }
    .track-step.done:not(:last-child)::after { background: #0a0a0a; }
    .track-dot {
        width: 28px; height: 28px; border-radius: 50%;
        border: 2px solid #d4d4d4; background: #fff;
        display: flex; align-items: center; justify-content: center;
        position: relative; z-index: 1;
    }
    .track-dot.active { background: #0a0a0a; border-color: #0a0a0a; }
    .track-dot.active svg {
        width: 13px; height: 13px; stroke: #fff; fill: none;
        stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round;
    }
    .track-dot:not(.active) svg { display: none; }
    .track-label { font-size: 10px; color: #888; white-space: nowrap; }
    .track-step.done .track-label { color: #0a0a0a; font-weight: 600; }
    .expected-delivery { font-size: 12px; color: #888; text-align: center; margin-top: 8px; }
    .expected-delivery strong { color: #0a0a0a; }

    /* ── Actions ── */
    .confirm-actions { display: flex; gap: 12px; width: 100%; margin-bottom: 16px; }
    .confirm-actions .btn-outline,
    .confirm-actions .btn-black { flex: 1; text-align: center; padding: 12px; }

    .email-notice {
        display: flex; align-items: center; gap: 8px;
        background: #f5f5f5; border-radius: 6px; padding: 10px 16px;
        font-size: 11px; color: #888; width: 100%;
    }
</style>
}

<div class="confirm-wrapper">

    <!-- Check Icon -->
    <div class="confirm-icon">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
    </div>

    <div class="confirm-title">Thank You!</div>
    <div class="confirm-sub">Your order has been placed successfully.</div>

    <div class="order-id-box">Order ID: #@Model.OrderId</div>

    <div class="confirm-card">

        <!-- Shipping Address -->
        <div class="confirm-section">
            <div class="confirm-section-title">Shipping Address</div>
            <div class="confirm-address">
                @Model.FullName<br />
                @Model.Address<br />
                @Model.City, @Model.PostalCode<br />
                @Model.Phone
            </div>
        </div>

        <!-- Order Items -->
        <div class="confirm-section">
            <div class="confirm-section-title">Items Ordered</div>
            <div class="confirm-items">
                @foreach (var item in Model.OrderItems)
                {
                    <div class="confirm-item">
                        <img class="confirm-item-img"
                             src="@item.ImageUrl" alt="@item.ProductName"
                             onerror="this.src='/images/placeholder.png'" />
                        <div>
                            <div class="confirm-item-name">@item.ProductName</div>
                            <div class="confirm-item-meta">
                                Qty: @item.Quantity
                                @if (!string.IsNullOrEmpty(item.Size)) { <span>| Size: @item.Size</span> }
                            </div>
                        </div>
                        <div class="confirm-item-price">₱@((item.UnitPrice * item.Quantity).ToString("N0"))</div>
                    </div>
                }
            </div>
            <div class="confirm-totals">
                <div class="confirm-total-row"><span>Subtotal</span><span>₱@Model.Subtotal.ToString("N0")</span></div>
                <div class="confirm-total-row"><span>Shipping (@Model.DeliveryOption)</span><span>₱@Model.ShippingFee.ToString("N0")</span></div>
                @if (Model.Discount > 0)
                {
                    <div class="confirm-total-row" style="color:#ef4444;"><span>Discount</span><span>-₱@Model.Discount.ToString("N0")</span></div>
                }
                <div class="confirm-total-row grand"><span>Total</span><span>₱@Model.Total.ToString("N0")</span></div>
            </div>
        </div>

        <!-- Track Order -->
        <div class="confirm-section">
            <div class="confirm-section-title">Track Your Order</div>

            @{
                var statuses = new[] { "Placed", "Processing", "Shipped", "Delivered" };
                int currentStep = Array.IndexOf(statuses, Model.OrderStatus);
                if (currentStep < 0) currentStep = 0;
            }

            <div class="track-steps">
                @for (int i = 0; i < statuses.Length; i++)
                {
                    bool isDone    = i <= currentStep;
                    bool isActive  = i == currentStep;
                    <div class="track-step @(isDone ? "done" : "")">
                        <div class="track-dot @(isActive ? "active" : "")">
                            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                        </div>
                        <span class="track-label">@statuses[i]</span>
                    </div>
                }
            </div>

            <div class="expected-delivery">
                Expected delivery by
                <strong>@Model.EstimatedDeliveryDate.ToString("MMM d, yyyy")</strong>
            </div>
        </div>

    </div>

    <!-- Action Buttons -->
    <div class="confirm-actions">
        <a class="btn-outline"
           asp-controller="Shop" asp-action="OrderDetail"
           asp-route-id="@Model.OrderId">
            View Order Details
        </a>
        <a class="btn-black" asp-controller="Shop" asp-action="Index">
            Continue Shopping
        </a>
    </div>

    <!-- Email Notice -->
    <div class="email-notice">
        ✉️ &nbsp; A confirmation email has been sent to <strong style="margin-left:4px;">@Model.Email</strong>
    </div>

</div>
